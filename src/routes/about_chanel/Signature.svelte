<script lang="ts">
	import { onMount } from 'svelte';

	const signature = [
		{
			path: 'M6.9,191.2c0,0,3.4-0.4,11.5-4.2c3.7-1.7,9.1-4.9,14.4-7.8c16.9-9.2,38.8-30.1,46.3-42.9 c7.5-12.9,11.4-19.6,12.6-29.9c1.1-10.3-1.7-38-2-47.7s-0.5-17.2,2.2-23.4s14.2-14.5,22.9-18.1s25.4-9.4,32.4-9.2 c7,0.3,11.9,0.6,11.4,8.3s-12.8,23.2-20.7,27.3c0,0-8.2,4.7-10.9,4.2',
			length: 323.57623291015625
		},
		{
			path: 'M125,137.7c0,0,6.2,0.1,10.4-2.3s18-7.3,24.1-11.9s11.2-8.4,16.5-13.8s9.8-12.1,9.6-15.5 c-0.1-3.3-2.2-8.5-6.1-6.6c-3.9,2-9.6,4.5-14.8,10.6s-20.8,24.1-23.3,27.5c-2.5,3.3-11.8,13.5-8.1,17c3.8,3.5,15.3-5.6,17.7-8 s16.4-20.8,17.1-21.8c0.7-1-13.1,13.8-8.1,22.2s8.7,4.9,12.3,3.3s14.8-8.2,19.8-11.9c5-3.6,18-14.7,23.4-19.8 c5.4-5.2,15.8-16.2,19.1-22.2s5.2-10.1,2.5-12.1s-10.2,4.2-13.7,12.7s-14.5,31.8-16.9,40.7c-2.4,8.9-4.3,12.8-0.1,15.5 c0,0,5.4,3.6,15.8-9.8s17.4-22.9,19.5-25.7s4.9-7.1,7.1-5.9s3.1,4.4,1.2,9.4c-2,5-2.8,7.8-5.7,12.7c-1.8,3.1-4.9,7-6.6,10.5 c-1,2.1-2.1,5.3-1.1,6.8c1.3,2,4.4-0.2,7.7-2c3.5-2,8.2-4.4,10.2-5.5c3.8-2.2,8.7-5,11-6.3c2.3-1.4,8.1-4.5,9.5-1.7 c1.4,2.9-1.2,3.8-3.3,7.5c-2.2,3.7-5.5,9.4-5.5,9.4',
			length: 597.25634765625
		},
		{
			path: 'M312.6,88.8c0,0,1.5,1.6,1.8,2.8c0.3,1.2,0.2,4.3,0.2,4.3',
			length: 7.669030666351318
		},
		{
			path: 'M328.9,120.8c0,0,4.3-2.9,7.1-7.4c2.8-4.5,4.7-8.4,3.2-9.2s-6.9-0.5-15.4,11.4c-8.6,11.9-9.7,16-10.2,19.6 s1.6,5.5,4,6.9s8.6-0.2,14-3.1c0,0,11.8-6.2,18.1-11.3c6.3-5,16.8-14,21.3-19.3s13.4-18.4,14.2-21.2c0.8-2.8-1.4-2-3.7,1 c0,0-13.1,18-17.4,29.7s-2.6,11.7-0.8,14c1.8,2.2,9.6-2.4,12.9-5.4c3.3-3,16.4-13,20.8-18c4.5-5,10.7-12.1,15.3-18.4 s10.4-17.7,8.2-19.2s-4.9,1.1-7.1,3.6c-3.6,3.9-6.1,7-10.6,13.1s-8.3,11.3-11.7,17.4c0,0-9.4,15.6-8.3,20.9s2.9,6.7,6.1,7.2 c3.3,0.5,13.2-3.4,19.9-7.5c6.7-4.1,16.4-11.3,18.8-13.1s7-4.2,7-4.2s-4.3,3.1-5.8,10.4c-1.8,8.7-1.5,11.3,1,13.6s7.4,2.5,12.2,0.1 c4.7-2.4,9.4-5.1,13.2-8.6',
			length: 492.9049987792969
		},
		{
			path: 'M4.2,132.4c4.7-2.4,9.4-5.1,13.2-8.6c3.7-3.4,7.8-8.3,10.3-12.9s4.2-8.1,3.3-10.6c-0.9-2.6-3.8-5.3-6.8-2.5 s-7.3,11.1-8.6,16.7c-1.2,5.6-0.9,11.4,1.7,14.7c2.6,3.3,10,6.7,19.9,4.9c10-1.8,22.6-5.8,31.7-10.6s18-10,25-15.4 s22.8-18.4,27.6-25.3c2.9-4.1,4.6-6.8,7.5-10.9c5.4-7.3,9-12.3,9-12.3s-24.4,33.7-28.1,40.2c-3.7,6.5-11.3,18.2-13,20.9 c-1.7,2.7-8,13.1-8,13.1s8.3-9.2,11.4-11.8c3.1-2.6,10-8.8,14-10.9s7.2-2.8,8.7-2.2c1.5,0.6,1.8,0.7,1,2.2s-4.6,9.8-5.9,13.9 c-1.3,4.2-0.9,9.3,0,10.8s3.3,4.5,7.7,4.3c4.5-0.2,7.8-0.6,15.2-3.4c7.4-2.9,17.4-7,22.3-10.4c4.8-3.4,9.1-6.1,12.1-9.3 c3-3.2,4.7-6.1,4.6-8.9c-0.1-2.8-4.2-4.8-7.6-4.3s-8.3,3-12.7,7.9s-9.6,12.1-10.1,15.7c-0.6,3.6,2.2,8,7,6.2 c4.7-1.8,19.5-8.7,21.8-10.2s8.8-6.5,8.8-6.5s-4.8,5-4.4,8.7c0.5,3.6,3.8,4.8,7.3,3.9c3.4-0.9,10.3-3,13.8-5.1 c3.4-2.1,12.5-5.9,12.5-5.9s-5.9,4.8-4.7,7c1.1,2.1,3.3,2.4,6.7,0.3c3.3-2,10.5-6.3,11.6-5.5s-1.4,3-0.2,6.7 c0.6,1.8,1.7,4.1,4.1,5.3c2.4,1.2,6.3,1.5,10.1,1.1c7.7-0.7,15-3.3,20.5-6.3s8.1-5.7,9.9-8s1.5-4.3,1.5-4.3s-2.5-4.2-5.4-4.2 s-7.1,2.7-7.8,6s0.4,8.9,5.2,11.4c4.8,2.5,13.9,2.9,20.5,2.2s15.7-4.3,21.5-7.1s10.3-4.7,16-8.9c5.7-4.3,16-13.6,20.4-18.6 s16-21.8,20.6-30.4s7.4-14.8,7.5-16.6s-1.8-4.1-5.4-1.3c-3.6,2.8-8.3,8-14.4,15.8s-8.8,12.5-15.6,21.7s-10.3,14.8-15,23.9 c0,0-8.3,14.2-7.8,21.6c0.4,7.3,5.5,9.8,10.8,11.6c5.3,1.9,20,4.9,29.6,6.3c9.6,1.4,21,3.3,29.5,5.2c8.5,2,13.6,2.9,16,4.3 s5.1,3.4,5.1,3.4',
			length: 1087.4395751953125
		}
		// {
		// 	// 3 & 4 together
		// 	path: 'M328.9 120.8c0 0 4.3-2.9 7.1-7.4 2.8-4.5 4.7-8.4 3.2-9.2s-6.9-.5-15.4 11.4c-8.6 11.9-9.7 16-10.2 19.6s1.6 5.5 4 6.9 8.6-.2 14-3.1c0 0 11.8-6.2 18.1-11.3 6.3-5 16.8-14 21.3-19.3s13.4-18.4 14.2-21.2c.8-2.8-1.4-2-3.7 1 0 0-13.1 18-17.4 29.7s-2.6 11.7-.8 14c1.8 2.2 9.6-2.4 12.9-5.4 3.3-3 16.4-13 20.8-18 4.5-5 10.7-12.1 15.3-18.4s10.4-17.7 8.2-19.2-4.9 1.1-7.1 3.6c-3.6 3.9-6.1 7-10.6 13.1s-8.3 11.3-11.7 17.4c0 0-9.4 15.6-8.3 20.9s2.9 6.7 6.1 7.2c3.3.5 13.2-3.4 19.9-7.5 6.7-4.1 16.4-11.3 18.8-13.1s7-4.2 7-4.2-4.3 3.1-5.8 10.4c-1.8 8.7-1.5 11.3 1 13.6s7.4 2.5 12.2.1c4.7-2.4 9.4-5.1 13.2-8.6 3.7-3.4 7.8-8.3 10.3-12.9s4.2-8.1 3.3-10.6c-.9-2.6-3.8-5.3-6.8-2.5s-7.3 11.1-8.6 16.7c-1.2 5.6-.9 11.4 1.7 14.7 2.6 3.3 10 6.7 19.9 4.9 10-1.8 22.6-5.8 31.7-10.6s18-10 25-15.4 22.8-18.4 27.6-25.3c2.9-4.1 4.6-6.8 7.5-10.9 5.4-7.3 9-12.3 9-12.3s-24.4 33.7-28.1 40.2c-3.7 6.5-11.3 18.2-13 20.9-1.7 2.7-8 13.1-8 13.1s8.3-9.2 11.4-11.8c3.1-2.6 10-8.8 14-10.9s7.2-2.8 8.7-2.2c1.5.6 1.8.7 1 2.2s-4.6 9.8-5.9 13.9c-1.3 4.2-.9 9.3 0 10.8s3.3 4.5 7.7 4.3c4.5-.2 7.8-.6 15.2-3.4 7.4-2.9 17.4-7 22.3-10.4 4.8-3.4 9.1-6.1 12.1-9.3 3-3.2 4.7-6.1 4.6-8.9-.1-2.8-4.2-4.8-7.6-4.3s-8.3 3-12.7 7.9-9.6 12.1-10.1 15.7c-.6 3.6 2.2 8 7 6.2 4.7-1.8 19.5-8.7 21.8-10.2s8.8-6.5 8.8-6.5-4.8 5-4.4 8.7c.5 3.6 3.8 4.8 7.3 3.9 3.4-.9 10.3-3 13.8-5.1 3.4-2.1 12.5-5.9 12.5-5.9s-5.9 4.8-4.7 7c1.1 2.1 3.3 2.4 6.7.3 3.3-2 10.5-6.3 11.6-5.5s-1.4 3-.2 6.7c.6 1.8 1.7 4.1 4.1 5.3 2.4 1.2 6.3 1.5 10.1 1.1 7.7-.7 15-3.3 20.5-6.3s8.1-5.7 9.9-8 1.5-4.3 1.5-4.3-2.5-4.2-5.4-4.2-7.1 2.7-7.8 6 .4 8.9 5.2 11.4c4.8 2.5 13.9 2.9 20.5 2.2s15.7-4.3 21.5-7.1 10.3-4.7 16-8.9c5.7-4.3 16-13.6 20.4-18.6s16-21.8 20.6-30.4 7.4-14.8 7.5-16.6-1.8-4.1-5.4-1.3c-3.6 2.8-8.3 8-14.4 15.8s-8.8 12.5-15.6 21.7-10.3 14.8-15 23.9c0 0-8.3 14.2-7.8 21.6.4 7.3 5.5 9.8 10.8 11.6 5.3 1.9 20 4.9 29.6 6.3 9.6 1.4 21 3.3 29.5 5.2 8.5 2 13.6 2.9 16 4.3s5.1 3.4 5.1 3.4',
		// 	length: 1564.5413818359375
		// }
	];

	// export let divHeight: number;

	const calTotalLength = () => {
		let total = 0;

		for (const path of signature) {
			total += path.length;
		}

		return total;
	};
	const calOffset = (index: number, totalOffset: number) => {
		let prevOffset = 0;
		for (let i = 0; i < index; i++) {
			prevOffset += signature[i].length;
		}

		let indexOffset = signature[index].length;
		if (totalOffset > prevOffset) {
			let curOffset = totalOffset - prevOffset;
			if (curOffset > indexOffset) {
				return 0;
			}
			return indexOffset - curOffset;
		}
		return indexOffset;
	};
	const calPercent = () => {
		return (window.scrollY >= 1000 ? 1000 : window.scrollY) / 1000;
	};
	const totalLength = calTotalLength();
	let totalOffset = 0;
	// console.log('total length : ', totalLength); // debug
	$: signatureOffset = signature.map((path, index) => {
		// console.log(`${index} : ${calOffset(index, totalOffset)}`); // debug
		return calOffset(index, totalOffset);
	});

	onMount(() => {
		totalOffset = totalLength * calPercent();
	});
</script>

<div class="sticky top-[187px] flex h-fit w-fit flex-row">
	<div class="relative h-fit w-fit">
		<svg
			class="absolute -left-[65px] top-[250px] h-[118px] w-[270px] fill-none stroke-black stroke-[4px]"
			viewBox="0 0 460 200.4"
			aria-hidden="true"
			focusable="false"
		>
			<path
				class="Signature"
				style="stroke-dasharray: {signature[0].length}; stroke-dashoffset: {signatureOffset[0]};"
				d={signature[0].path}
			/>
			<path
				class="Signature"
				style="stroke-dasharray: {signature[1].length}; stroke-dashoffset: {signatureOffset[1]};"
				d={signature[1].path}
			/>
			<path
				class="Signature"
				style="stroke-dasharray: {signature[2].length}; stroke-dashoffset: {signatureOffset[2]};"
				d={signature[2].path}
			/>
			<path
				class="Signature"
				style="stroke-dasharray: {signature[3].length}; stroke-dashoffset: {signatureOffset[3]};"
				d={signature[3].path}
			/>
		</svg>
		<svg
			class="absolute left-[620px] top-[230px] h-[133px] w-[270px] fill-none stroke-black stroke-[4px]"
			viewBox="0 0 408.9 200.4"
			aria-hidden="true"
			focusable="false"
		>
			<path
				class="Signature"
				style="stroke-dasharray: {signature[4].length}; stroke-dashoffset: {signatureOffset[4]};"
				d={signature[4].path}
			/>
		</svg>
	</div>
	<img class="h-[610px]" src="/Chanel/Signature/chanel.webp" alt="" />
</div>

<svelte:window
	on:scroll={() => {
		totalOffset = totalLength * calPercent();
		// console.log('Y :', window.scrollY); // debug
		// console.log(`length : ${totalOffset} (${percentage})`); // debug
	}}
/>

<style>
	.Signature {
		transition: all linear;
	}
</style>
